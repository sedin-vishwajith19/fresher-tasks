pipeline {

  agent {
    label "demo-temp-runner"
  }

  parameters {
    string(
      name: 'RUNNER_LABEL',
      defaultValue: '',
      description: 'Ephemeral runner label passed from infra CI'
    )
  }

  options {
    timestamps()
    disableConcurrentBuilds()
  }

  environment {
    APP_NAME = "ruby-application"
  }

  stages {

    stage('Checkout') {
      steps {
        sh '''
          git clone https://github.com/sedin-vishwajith19/fresher-tasks.git
        '''
      }
    }

    stage('Build') {
      steps {
        echo "Building ${APP_NAME}"
        sh '''
          cd engine_X/second_task/myapp
          docker build -t ruby-app .
        '''
      }
    }

    stage('Test') {
      steps {
        echo "Running tests"
        sh '''
          docker compose up -d --build
        '''
      }
    }
  }

  post {
    success {
      echo "CI pipeline succeeded"
    }
    failure {
      echo "CI pipeline failed"
    }
    always {
      cleanWs()
    }
  }
}

